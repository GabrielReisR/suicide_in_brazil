---
title: "Suicídio no Brasil"
author: "Gabriel R. R."
date: "4/15/2021"
output: 
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    smooth_scroll: true
    df_print: paged
    code_folding: show
---

```{r setup and pre processing, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Initializing ====
# Loading libraries
library(dplyr)
library(gganimate)
library(ggplot2)
library(ggthemes)
library(gifski)
library(hrbrthemes)
library(lubridate)
library(magrittr)
library(plotly)
library(psych)
library(viridis)

df <- read.csv('df.csv', encoding = 'UTF-8')[-1]

# Initial cleaning ====
# Making missings known
df[df == 'NaN'] <- NA

# Arranging dates
format <- "%d%m%Y"
df$DTOBITO <- parse_date_time(df$DTOBITO, format)
df$DTNASC <- parse_date_time(df$DTNASC, format)

# Creating 'month' column
df$mes <- month(df$DTOBITO)

# Creating only number of deaths dataframes by month/year ====
year_total <- df %>% group_by(ano) %>% count()

month_total <- df %>% group_by(mes) %>% count()

ym_total <- df %>% 
  group_by(ano, mes) %>% 
  count() %>% 
  tidyr::unite(mes, ano, col = 'index', sep = '-')

ym_total

# Creating variations ====
#' *year_variation*
year_variation <- as.data.frame(year_total)
rownames(year_variation) <- year_variation$ano
year_variation %<>% select(-ano)
year_variation

year_variation <- as.ts(year_variation, start = c(2010), frequency = 1)

year_variation <- year_variation/stats::lag(year_variation, -1) - 1

#' *month variation*
month_variation <- as.data.frame(month_total)
rownames(month_variation) <- month_variation$mes
month_variation %<>% select(-mes)
month_variation

month_variation <- as.ts(month_variation, start = c(1), frequency = 1)

month_variation <- month_variation/stats::lag(month_variation, -1) - 1

month_variation*100

#' *ym_variation*
ym_variation <- as.data.frame(ym_total)
rownames(ym_variation) <- ym_variation$index
ym_variation %<>% select(-index)
rownames(ym_variation) <- NULL

ym_variation <- as.ts(ym_variation, start = c(2010, 1), frequency = 12)

ym_variation <- ym_variation/stats::lag(ym_variation, -1) - 1

head(ym_variation, n = 20)
```

## Suicídio no Brasil

### Extração de dados
Os dados foram extraídos utilizando-se a ferramenta [PySUS](https://github.com/AlertaDengue/PySUS),
seguindo-se o tutorial descrito [aqui](https://medium.com/psicodata/baixando-e-processando-dados-do-datasus-sobre-suic%C3%ADdio-com-python-656afa17f6ad?source=friends_link&sk=4e94866d21707aefec13aafe5923d6f1).
Foram baixados os dados de 2010 a 2019, contemplando 10 anos de uma série histórica. Os dados foram pré-processados em Python, podendo todos os procedimentos iniciais de pré-processamento
serem verificados [neste link](). As análises subsequentes foram realizadas em R, conforme é descrito
nesse documento.

Qualquer dúvida, comentário ou retificação podem ser enviadas para reisrgabriel@gmail.com

### Variação ao longo dos anos

```{r serie_historica, echo = F, dpi = 500}
yearly_variation <- as.data.frame(year_variation * 100)
yearly_variation$index <- parse_date_time(c(2011:2019), '%Y')

yearly_variation %>% 
  
  # Plot
  ggplot(aes(x = as.Date(index), y = year_variation, fill = index)) +
  
  # Geom
  geom_col() +
  
  # X-axis: Limits and ticks
  scale_x_date(date_breaks = 'years', date_labels = '%Y') +
  
  # Y-axis: Limits and ticks
  scale_y_continuous(breaks = seq(0, 10, 2.5), limits = c(0, 10)) +
  
  # X-axis: Colors
  scale_fill_gradient2(low = 'darkgreen', mid = 'snow3', high = 'red') +
  
  # Labels
  labs(x = '',
       y = 'Variação em Relação ao Ano Anterior (%)',
       title = 'Variação Percentual no Número de Casos\nRegistrados de Suicídio no Brasil por Ano') +
  
  # Annotations
  annotate(geom = "text", x = as.Date("2014-01-01"), y = 9,
           label = "Em 2017, houve um aumento de 9.31% de\ncasos de suicídio em comparação a 2016.") +
  
  # Theme
  theme_bw() +
  
  # Removing legend title
  theme(legend.position = "none",
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.border = element_blank())
```

### Visualização da série histórica

![Quadrantes do RStudio](D:/Data Science/Projetos/suicide_in_brazil/suicides_across_years.gif)

### Suicídios por sexo

![Quadrantes do RStudio](D:/Data Science/Projetos/suicide_in_brazil/suicides_by_sex_by_year.gif)